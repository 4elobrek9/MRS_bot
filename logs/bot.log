2025-07-18 16:09:29,577 - WARNING - core.main.ez_main - CHANNEL_ID is not set or invalid. Jokes task will be disabled.
2025-07-18 16:09:29,746 - DEBUG - asyncio - Using proactor: IocpProactor
2025-07-18 16:09:29,747 - INFO - core.main.ez_main - main: Запуск основной функции бота.
2025-07-18 16:09:29,747 - INFO - core.group.stat.smain - ProfileManager instance initialized.
2025-07-18 16:09:29,747 - DEBUG - core.group.stat.smain - Attempting to connect to profiles database asynchronously.
2025-07-18 16:09:29,747 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x0000018984381760>
2025-07-18 16:09:29,748 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x0000018984381760> completed
2025-07-18 16:09:29,749 - INFO - core.group.stat.smain - Profiles database connected asynchronously.
2025-07-18 16:09:29,749 - DEBUG - core.group.stat.smain - Starting asynchronous profiles database schema initialization.
2025-07-18 16:09:29,749 - DEBUG - aiosqlite - executing functools.partial(<built-in method cursor of sqlite3.Connection object at 0x00000189843494E0>)
2025-07-18 16:09:29,749 - DEBUG - aiosqlite - operation functools.partial(<built-in method cursor of sqlite3.Connection object at 0x00000189843494E0>) completed
2025-07-18 16:09:29,750 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Cursor object at 0x0000018984385B40>, '\n        CREATE TABLE IF NOT EXISTS users (\n            user_id INTEGER PRIMARY KEY,\n            username TEXT,\n            first_name TEXT,\n            last_name TEXT,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n        ', [])
2025-07-18 16:09:29,750 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Cursor object at 0x0000018984385B40>, '\n        CREATE TABLE IF NOT EXISTS users (\n            user_id INTEGER PRIMARY KEY,\n            username TEXT,\n            first_name TEXT,\n            last_name TEXT,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n        ', []) completed
2025-07-18 16:09:29,750 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Cursor object at 0x0000018984385B40>, '\n        CREATE TABLE IF NOT EXISTS user_profiles (\n            profile_id INTEGER PRIMARY KEY AUTOINCREMENT,\n            user_id INTEGER UNIQUE,\n            hp INTEGER DEFAULT 100 CHECK(hp >= 0 AND hp <= 150),\n            level INTEGER DEFAULT 1 CHECK(level >= 1 AND level <= 169),\n            exp INTEGER DEFAULT 0,\n            lumcoins INTEGER DEFAULT 0,\n            daily_messages INTEGER DEFAULT 0,\n            total_messages INTEGER DEFAULT 0,\n            flames INTEGER DEFAULT 0,\n            last_work_time REAL DEFAULT 0,\n            FOREIGN KEY (user_id) REFERENCES users (user_id)\n        )\n        ', [])
2025-07-18 16:09:29,751 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Cursor object at 0x0000018984385B40>, '\n        CREATE TABLE IF NOT EXISTS user_profiles (\n            profile_id INTEGER PRIMARY KEY AUTOINCREMENT,\n            user_id INTEGER UNIQUE,\n            hp INTEGER DEFAULT 100 CHECK(hp >= 0 AND hp <= 150),\n            level INTEGER DEFAULT 1 CHECK(level >= 1 AND level <= 169),\n            exp INTEGER DEFAULT 0,\n            lumcoins INTEGER DEFAULT 0,\n            daily_messages INTEGER DEFAULT 0,\n            total_messages INTEGER DEFAULT 0,\n            flames INTEGER DEFAULT 0,\n            last_work_time REAL DEFAULT 0,\n            FOREIGN KEY (user_id) REFERENCES users (user_id)\n        )\n        ', []) completed
2025-07-18 16:09:29,751 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Cursor object at 0x0000018984385B40>, 'CREATE INDEX IF NOT EXISTS idx_user_profiles_user_id ON user_profiles(user_id)', [])
2025-07-18 16:09:29,751 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Cursor object at 0x0000018984385B40>, 'CREATE INDEX IF NOT EXISTS idx_user_profiles_user_id ON user_profiles(user_id)', []) completed
2025-07-18 16:09:29,751 - DEBUG - aiosqlite - executing functools.partial(<built-in method commit of sqlite3.Connection object at 0x00000189843494E0>)
2025-07-18 16:09:29,752 - DEBUG - aiosqlite - operation functools.partial(<built-in method commit of sqlite3.Connection object at 0x00000189843494E0>) completed
2025-07-18 16:09:29,752 - INFO - core.group.stat.smain - Asynchronous profiles database tables checked/created.
2025-07-18 16:09:29,753 - INFO - core.group.stat.smain - Asynchronous profiles database schema check/initialization completed.
2025-07-18 16:09:29,753 - INFO - core.main.ez_main - main: ProfileManager подключен.
2025-07-18 16:09:29,753 - INFO - core.main.ez_main - main: Инициализация основной базы данных.
2025-07-18 16:09:29,753 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x0000018984381A80>
2025-07-18 16:09:29,754 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x0000018984381A80> completed
2025-07-18 16:09:29,754 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE TABLE IF NOT EXISTS users (\n                user_id INTEGER PRIMARY KEY,\n                username TEXT,\n                first_name TEXT NOT NULL,\n                last_active_ts REAL DEFAULT 0\n            )\n        ', [])
2025-07-18 16:09:29,754 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE TABLE IF NOT EXISTS users (\n                user_id INTEGER PRIMARY KEY,\n                username TEXT,\n                first_name TEXT NOT NULL,\n                last_active_ts REAL DEFAULT 0\n            )\n        ', []) completed
2025-07-18 16:09:29,755 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE TABLE IF NOT EXISTS value_subscriptions (\n                user_id INTEGER PRIMARY KEY,\n                subscribed_ts REAL NOT NULL,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ', [])
2025-07-18 16:09:29,755 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE TABLE IF NOT EXISTS value_subscriptions (\n                user_id INTEGER PRIMARY KEY,\n                subscribed_ts REAL NOT NULL,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ', []) completed
2025-07-18 16:09:29,755 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, "\n            CREATE TABLE IF NOT EXISTS dialog_history (\n                history_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                timestamp REAL NOT NULL,\n                mode TEXT NOT NULL,\n                role TEXT NOT NULL CHECK(role IN ('user', 'assistant')),\n                content TEXT NOT NULL,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", [])
2025-07-18 16:09:29,756 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, "\n            CREATE TABLE IF NOT EXISTS dialog_history (\n                history_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                timestamp REAL NOT NULL,\n                mode TEXT NOT NULL,\n                role TEXT NOT NULL CHECK(role IN ('user', 'assistant')),\n                content TEXT NOT NULL,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", []) completed
2025-07-18 16:09:29,756 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE INDEX IF NOT EXISTS idx_dialog_history_user_ts ON dialog_history (user_id, timestamp DESC)\n        ', [])
2025-07-18 16:09:29,756 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE INDEX IF NOT EXISTS idx_dialog_history_user_ts ON dialog_history (user_id, timestamp DESC)\n        ', []) completed
2025-07-18 16:09:29,756 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, "\n            CREATE TABLE IF NOT EXISTS user_modes (\n                user_id INTEGER PRIMARY KEY,\n                mode TEXT NOT NULL DEFAULT 'saharoza',\n                rating_opportunities_count INTEGER DEFAULT 0,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", [])
2025-07-18 16:09:29,757 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, "\n            CREATE TABLE IF NOT EXISTS user_modes (\n                user_id INTEGER PRIMARY KEY,\n                mode TEXT NOT NULL DEFAULT 'saharoza',\n                rating_opportunities_count INTEGER DEFAULT 0,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", []) completed
2025-07-18 16:09:29,757 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, "\n            CREATE TABLE IF NOT EXISTS analytics_interactions (\n                interaction_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                timestamp REAL NOT NULL,\n                mode TEXT NOT NULL,\n                action_type TEXT NOT NULL DEFAULT 'message',\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", [])
2025-07-18 16:09:29,757 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, "\n            CREATE TABLE IF NOT EXISTS analytics_interactions (\n                interaction_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                timestamp REAL NOT NULL,\n                mode TEXT NOT NULL,\n                action_type TEXT NOT NULL DEFAULT 'message',\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", []) completed
2025-07-18 16:09:29,758 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE INDEX IF NOT EXISTS idx_interactions_user_ts_mode ON analytics_interactions (user_id, timestamp DESC, mode)\n        ', [])
2025-07-18 16:09:29,758 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE INDEX IF NOT EXISTS idx_interactions_user_ts_mode ON analytics_interactions (user_id, timestamp DESC, mode)\n        ', []) completed
2025-07-18 16:09:29,758 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE TABLE IF NOT EXISTS analytics_ratings (\n                rating_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                rated_message_id INTEGER,\n                dialog_history_id INTEGER,\n                timestamp REAL NOT NULL,\n                rating INTEGER NOT NULL CHECK(rating IN (0, 1)),\n                message_preview TEXT,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE,\n                FOREIGN KEY(dialog_history_id) REFERENCES dialog_history(history_id) ON DELETE SET NULL\n            )\n        ', [])
2025-07-18 16:09:29,759 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE TABLE IF NOT EXISTS analytics_ratings (\n                rating_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                rated_message_id INTEGER,\n                dialog_history_id INTEGER,\n                timestamp REAL NOT NULL,\n                rating INTEGER NOT NULL CHECK(rating IN (0, 1)),\n                message_preview TEXT,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE,\n                FOREIGN KEY(dialog_history_id) REFERENCES dialog_history(history_id) ON DELETE SET NULL\n            )\n        ', []) completed
2025-07-18 16:09:29,759 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE TABLE IF NOT EXISTS rp_user_stats (\n                user_id INTEGER PRIMARY KEY,\n                hp INTEGER NOT NULL DEFAULT 100,\n                heal_cooldown_ts REAL NOT NULL DEFAULT 0,\n                recovery_end_ts REAL NOT NULL DEFAULT 0,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ', [])
2025-07-18 16:09:29,759 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x00000189843497B0>, '\n            CREATE TABLE IF NOT EXISTS rp_user_stats (\n                user_id INTEGER PRIMARY KEY,\n                hp INTEGER NOT NULL DEFAULT 100,\n                heal_cooldown_ts REAL NOT NULL DEFAULT 0,\n                recovery_end_ts REAL NOT NULL DEFAULT 0,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ', []) completed
2025-07-18 16:09:29,759 - DEBUG - aiosqlite - executing functools.partial(<built-in method commit of sqlite3.Connection object at 0x00000189843497B0>)
2025-07-18 16:09:29,759 - DEBUG - aiosqlite - operation functools.partial(<built-in method commit of sqlite3.Connection object at 0x00000189843497B0>) completed
2025-07-18 16:09:29,760 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x00000189843497B0>)
2025-07-18 16:09:29,760 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x00000189843497B0>) completed
2025-07-18 16:09:29,760 - INFO - database - Database initialized successfully.
2025-07-18 16:09:29,760 - INFO - core.main.ez_main - main: Инициализация StickerManager и загрузка стикеров.
2025-07-18 16:09:29,761 - INFO - core.main.ez_main - Stickers loaded from cache.
2025-07-18 16:09:29,761 - INFO - core.main.ez_main - Fetching stickers from Telegram...
2025-07-18 16:09:29,761 - INFO - core.main.ez_main - Stickers for mode 'saharoza' already loaded (possibly from cache). Skipping fetch.
2025-07-18 16:09:29,761 - INFO - core.main.ez_main - Stickers for mode 'dedinside' already loaded (possibly from cache). Skipping fetch.
2025-07-18 16:09:29,761 - INFO - core.main.ez_main - Stickers for mode 'genius' already loaded (possibly from cache). Skipping fetch.
2025-07-18 16:09:29,762 - INFO - core.main.ez_main - Stickers saved to cache.
2025-07-18 16:09:29,762 - DEBUG - core.main.ez_main - main: Передача зависимостей в диспетчер.
2025-07-18 16:09:29,762 - INFO - core.main.ez_main - main: Настройка и включение модуля цензуры (первый приоритет для групп).
2025-07-18 16:09:29,763 - DEBUG - censor_module - setup_censor_handlers: Начата настройка модуля цензуры.
2025-07-18 16:09:29,763 - DEBUG - censor_module - censor_module.load_bad_words: Попытка загрузить слова из файла: C:\4chan\.GITHUB\MRS_bot\data\bad_words.txt
2025-07-18 16:09:29,764 - INFO - censor_module - censor_module.load_bad_words: Успешно загружено 43 корней 'злых' слов из C:\4chan\.GITHUB\MRS_bot\data\bad_words.txt.
2025-07-18 16:09:29,764 - DEBUG - censor_module - setup_censor_handlers: Загружены не-слеш команды для игнорирования цензором: ['романтический поцелуй', 'поцеловать в щёчку', 'схватить за шею', 'толкнуть сильно', 'список действий', 'почесать спинку', 'прижать к себе', 'сделать массаж', 'подарить цветы', 'моё здоровье', 'мое здоровье', 'спеть песню', 'разозлиться', 'попрощаться', 'рп действия', 'поцеловать', 'испугаться', 'подмигнуть', 'команды рп', 'издеваться', 'превратить', 'засмеяться', 'заплакать', 'удивиться', 'постучать', 'успокоить', 'список рп', 'погладить', 'похлопать', 'покормить', 'подрочить', 'помахать', 'работать', 'шлепнуть', 'здоровье', 'толкнуть', 'схватить', 'обозвать', 'полечить', 'ущипнуть', 'пощечина', 'трахнуть', 'кивнуть', 'напоить', 'плюнуть', 'ударить', 'укусить', 'магазин', 'шепнуть', 'профиль', 'обидеть', 'моё хп', 'уебать', 'обнять', 'мое хп', 'пнуть', 'топ', 'хп']
2025-07-18 16:09:29,765 - DEBUG - censor_module - setup_censor_handlers: Включение censor_router в главный диспетчер.
2025-07-18 16:09:29,765 - INFO - censor_module - setup_censor_handlers: Обработчики модуля цензуры успешно настроены и включены в главный диспетчер.
2025-07-18 16:09:29,766 - INFO - core.main.ez_main - main: Модуль цензуры успешно интегрирован.
2025-07-18 16:09:29,767 - CRITICAL - core.main.ez_main - main: Необработанное исключение при основном выполнении: At least one command should be specified
Traceback (most recent call last):
  File "c:\4chan\.GITHUB\MRS_bot\main.py", line 160, in <module>
    asyncio.run(main())
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python312\Lib\asyncio\base_events.py", line 686, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "c:\4chan\.GITHUB\MRS_bot\main.py", line 78, in main
    group_text_router.message.filter(~Command())
                                     ^^^^^^^^^
  File "C:\Users\aboby\AppData\Roaming\Python\Python312\site-packages\aiogram\filters\command.py", line 96, in __init__
    raise ValueError("At least one command should be specified")
ValueError: At least one command should be specified
2025-07-18 16:53:22,501 - WARNING - core.main.ez_main - CHANNEL_ID is not set or invalid. Jokes task will be disabled.
2025-07-18 16:53:22,679 - DEBUG - asyncio - Using proactor: IocpProactor
2025-07-18 16:53:22,680 - INFO - core.main.ez_main - main: Запуск основной функции бота.
2025-07-18 16:53:22,680 - INFO - core.group.stat.smain - ProfileManager instance initialized.
2025-07-18 16:53:22,680 - DEBUG - core.group.stat.smain - Attempting to connect to profiles database asynchronously.
2025-07-18 16:53:22,680 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F341760>
2025-07-18 16:53:22,681 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F341760> completed
2025-07-18 16:53:22,681 - INFO - core.group.stat.smain - Profiles database connected asynchronously.
2025-07-18 16:53:22,681 - DEBUG - core.group.stat.smain - Starting asynchronous profiles database schema initialization.
2025-07-18 16:53:22,681 - DEBUG - aiosqlite - executing functools.partial(<built-in method cursor of sqlite3.Connection object at 0x000002254F3094E0>)
2025-07-18 16:53:22,681 - DEBUG - aiosqlite - operation functools.partial(<built-in method cursor of sqlite3.Connection object at 0x000002254F3094E0>) completed
2025-07-18 16:53:22,681 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Cursor object at 0x000002254F345B40>, '\n        CREATE TABLE IF NOT EXISTS users (\n            user_id INTEGER PRIMARY KEY,\n            username TEXT,\n            first_name TEXT,\n            last_name TEXT,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n        ', [])
2025-07-18 16:53:22,681 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Cursor object at 0x000002254F345B40>, '\n        CREATE TABLE IF NOT EXISTS users (\n            user_id INTEGER PRIMARY KEY,\n            username TEXT,\n            first_name TEXT,\n            last_name TEXT,\n            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n        )\n        ', []) completed
2025-07-18 16:53:22,682 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Cursor object at 0x000002254F345B40>, '\n        CREATE TABLE IF NOT EXISTS user_profiles (\n            profile_id INTEGER PRIMARY KEY AUTOINCREMENT,\n            user_id INTEGER UNIQUE,\n            hp INTEGER DEFAULT 100 CHECK(hp >= 0 AND hp <= 150),\n            level INTEGER DEFAULT 1 CHECK(level >= 1 AND level <= 169),\n            exp INTEGER DEFAULT 0,\n            lumcoins INTEGER DEFAULT 0,\n            daily_messages INTEGER DEFAULT 0,\n            total_messages INTEGER DEFAULT 0,\n            flames INTEGER DEFAULT 0,\n            last_work_time REAL DEFAULT 0,\n            FOREIGN KEY (user_id) REFERENCES users (user_id)\n        )\n        ', [])
2025-07-18 16:53:22,682 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Cursor object at 0x000002254F345B40>, '\n        CREATE TABLE IF NOT EXISTS user_profiles (\n            profile_id INTEGER PRIMARY KEY AUTOINCREMENT,\n            user_id INTEGER UNIQUE,\n            hp INTEGER DEFAULT 100 CHECK(hp >= 0 AND hp <= 150),\n            level INTEGER DEFAULT 1 CHECK(level >= 1 AND level <= 169),\n            exp INTEGER DEFAULT 0,\n            lumcoins INTEGER DEFAULT 0,\n            daily_messages INTEGER DEFAULT 0,\n            total_messages INTEGER DEFAULT 0,\n            flames INTEGER DEFAULT 0,\n            last_work_time REAL DEFAULT 0,\n            FOREIGN KEY (user_id) REFERENCES users (user_id)\n        )\n        ', []) completed
2025-07-18 16:53:22,682 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Cursor object at 0x000002254F345B40>, 'CREATE INDEX IF NOT EXISTS idx_user_profiles_user_id ON user_profiles(user_id)', [])
2025-07-18 16:53:22,682 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Cursor object at 0x000002254F345B40>, 'CREATE INDEX IF NOT EXISTS idx_user_profiles_user_id ON user_profiles(user_id)', []) completed
2025-07-18 16:53:22,683 - DEBUG - aiosqlite - executing functools.partial(<built-in method commit of sqlite3.Connection object at 0x000002254F3094E0>)
2025-07-18 16:53:22,683 - DEBUG - aiosqlite - operation functools.partial(<built-in method commit of sqlite3.Connection object at 0x000002254F3094E0>) completed
2025-07-18 16:53:22,683 - INFO - core.group.stat.smain - Asynchronous profiles database tables checked/created.
2025-07-18 16:53:22,683 - INFO - core.group.stat.smain - Asynchronous profiles database schema check/initialization completed.
2025-07-18 16:53:22,683 - INFO - core.main.ez_main - main: ProfileManager подключен.
2025-07-18 16:53:22,683 - INFO - core.main.ez_main - main: Инициализация основной базы данных.
2025-07-18 16:53:22,684 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F3419E0>
2025-07-18 16:53:22,685 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F3419E0> completed
2025-07-18 16:53:22,685 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE TABLE IF NOT EXISTS users (\n                user_id INTEGER PRIMARY KEY,\n                username TEXT,\n                first_name TEXT NOT NULL,\n                last_active_ts REAL DEFAULT 0\n            )\n        ', [])
2025-07-18 16:53:22,685 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE TABLE IF NOT EXISTS users (\n                user_id INTEGER PRIMARY KEY,\n                username TEXT,\n                first_name TEXT NOT NULL,\n                last_active_ts REAL DEFAULT 0\n            )\n        ', []) completed
2025-07-18 16:53:22,685 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE TABLE IF NOT EXISTS value_subscriptions (\n                user_id INTEGER PRIMARY KEY,\n                subscribed_ts REAL NOT NULL,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ', [])
2025-07-18 16:53:22,686 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE TABLE IF NOT EXISTS value_subscriptions (\n                user_id INTEGER PRIMARY KEY,\n                subscribed_ts REAL NOT NULL,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ', []) completed
2025-07-18 16:53:22,686 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, "\n            CREATE TABLE IF NOT EXISTS dialog_history (\n                history_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                timestamp REAL NOT NULL,\n                mode TEXT NOT NULL,\n                role TEXT NOT NULL CHECK(role IN ('user', 'assistant')),\n                content TEXT NOT NULL,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", [])
2025-07-18 16:53:22,686 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, "\n            CREATE TABLE IF NOT EXISTS dialog_history (\n                history_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                timestamp REAL NOT NULL,\n                mode TEXT NOT NULL,\n                role TEXT NOT NULL CHECK(role IN ('user', 'assistant')),\n                content TEXT NOT NULL,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", []) completed
2025-07-18 16:53:22,686 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE INDEX IF NOT EXISTS idx_dialog_history_user_ts ON dialog_history (user_id, timestamp DESC)\n        ', [])
2025-07-18 16:53:22,686 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE INDEX IF NOT EXISTS idx_dialog_history_user_ts ON dialog_history (user_id, timestamp DESC)\n        ', []) completed
2025-07-18 16:53:22,687 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, "\n            CREATE TABLE IF NOT EXISTS user_modes (\n                user_id INTEGER PRIMARY KEY,\n                mode TEXT NOT NULL DEFAULT 'saharoza',\n                rating_opportunities_count INTEGER DEFAULT 0,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", [])
2025-07-18 16:53:22,687 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, "\n            CREATE TABLE IF NOT EXISTS user_modes (\n                user_id INTEGER PRIMARY KEY,\n                mode TEXT NOT NULL DEFAULT 'saharoza',\n                rating_opportunities_count INTEGER DEFAULT 0,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", []) completed
2025-07-18 16:53:22,687 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, "\n            CREATE TABLE IF NOT EXISTS analytics_interactions (\n                interaction_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                timestamp REAL NOT NULL,\n                mode TEXT NOT NULL,\n                action_type TEXT NOT NULL DEFAULT 'message',\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", [])
2025-07-18 16:53:22,687 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, "\n            CREATE TABLE IF NOT EXISTS analytics_interactions (\n                interaction_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                timestamp REAL NOT NULL,\n                mode TEXT NOT NULL,\n                action_type TEXT NOT NULL DEFAULT 'message',\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ", []) completed
2025-07-18 16:53:22,688 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE INDEX IF NOT EXISTS idx_interactions_user_ts_mode ON analytics_interactions (user_id, timestamp DESC, mode)\n        ', [])
2025-07-18 16:53:22,688 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE INDEX IF NOT EXISTS idx_interactions_user_ts_mode ON analytics_interactions (user_id, timestamp DESC, mode)\n        ', []) completed
2025-07-18 16:53:22,688 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE TABLE IF NOT EXISTS analytics_ratings (\n                rating_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                rated_message_id INTEGER,\n                dialog_history_id INTEGER,\n                timestamp REAL NOT NULL,\n                rating INTEGER NOT NULL CHECK(rating IN (0, 1)),\n                message_preview TEXT,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE,\n                FOREIGN KEY(dialog_history_id) REFERENCES dialog_history(history_id) ON DELETE SET NULL\n            )\n        ', [])
2025-07-18 16:53:22,688 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE TABLE IF NOT EXISTS analytics_ratings (\n                rating_id INTEGER PRIMARY KEY AUTOINCREMENT,\n                user_id INTEGER NOT NULL,\n                rated_message_id INTEGER,\n                dialog_history_id INTEGER,\n                timestamp REAL NOT NULL,\n                rating INTEGER NOT NULL CHECK(rating IN (0, 1)),\n                message_preview TEXT,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE,\n                FOREIGN KEY(dialog_history_id) REFERENCES dialog_history(history_id) ON DELETE SET NULL\n            )\n        ', []) completed
2025-07-18 16:53:22,688 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE TABLE IF NOT EXISTS rp_user_stats (\n                user_id INTEGER PRIMARY KEY,\n                hp INTEGER NOT NULL DEFAULT 100,\n                heal_cooldown_ts REAL NOT NULL DEFAULT 0,\n                recovery_end_ts REAL NOT NULL DEFAULT 0,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ', [])
2025-07-18 16:53:22,689 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F3097B0>, '\n            CREATE TABLE IF NOT EXISTS rp_user_stats (\n                user_id INTEGER PRIMARY KEY,\n                hp INTEGER NOT NULL DEFAULT 100,\n                heal_cooldown_ts REAL NOT NULL DEFAULT 0,\n                recovery_end_ts REAL NOT NULL DEFAULT 0,\n                FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE\n            )\n        ', []) completed
2025-07-18 16:53:22,689 - DEBUG - aiosqlite - executing functools.partial(<built-in method commit of sqlite3.Connection object at 0x000002254F3097B0>)
2025-07-18 16:53:22,689 - DEBUG - aiosqlite - operation functools.partial(<built-in method commit of sqlite3.Connection object at 0x000002254F3097B0>) completed
2025-07-18 16:53:22,690 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F3097B0>)
2025-07-18 16:53:22,690 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F3097B0>) completed
2025-07-18 16:53:22,690 - INFO - database - Database initialized successfully.
2025-07-18 16:53:22,690 - INFO - core.main.ez_main - main: Инициализация StickerManager и загрузка стикеров.
2025-07-18 16:53:22,691 - INFO - core.main.ez_main - Stickers loaded from cache.
2025-07-18 16:53:22,691 - INFO - core.main.ez_main - Fetching stickers from Telegram...
2025-07-18 16:53:22,691 - INFO - core.main.ez_main - Stickers for mode 'saharoza' already loaded (possibly from cache). Skipping fetch.
2025-07-18 16:53:22,692 - INFO - core.main.ez_main - Stickers for mode 'dedinside' already loaded (possibly from cache). Skipping fetch.
2025-07-18 16:53:22,692 - INFO - core.main.ez_main - Stickers for mode 'genius' already loaded (possibly from cache). Skipping fetch.
2025-07-18 16:53:22,692 - INFO - core.main.ez_main - Stickers saved to cache.
2025-07-18 16:53:22,692 - DEBUG - core.main.ez_main - main: Передача зависимостей в диспетчер.
2025-07-18 16:53:22,692 - INFO - core.main.ez_main - main: Настройка и включение модуля цензуры (первый приоритет для групп).
2025-07-18 16:53:22,693 - DEBUG - censor_module - setup_censor_handlers: Начата настройка модуля цензуры.
2025-07-18 16:53:22,693 - DEBUG - censor_module - censor_module.load_bad_words: Попытка загрузить слова из файла: C:\4chan\.GITHUB\MRS_bot\data\bad_words.txt
2025-07-18 16:53:22,693 - INFO - censor_module - censor_module.load_bad_words: Успешно загружено 43 корней 'злых' слов из C:\4chan\.GITHUB\MRS_bot\data\bad_words.txt.
2025-07-18 16:53:22,693 - DEBUG - censor_module - setup_censor_handlers: Загружены не-слеш команды для игнорирования цензором: ['романтический поцелуй', 'поцеловать в щёчку', 'толкнуть сильно', 'почесать спинку', 'список действий', 'схватить за шею', 'прижать к себе', 'сделать массаж', 'подарить цветы', 'мое здоровье', 'моё здоровье', 'спеть песню', 'разозлиться', 'попрощаться', 'рп действия', 'издеваться', 'превратить', 'засмеяться', 'испугаться', 'подмигнуть', 'поцеловать', 'команды рп', 'заплакать', 'похлопать', 'список рп', 'покормить', 'удивиться', 'подрочить', 'погладить', 'постучать', 'успокоить', 'схватить', 'пощечина', 'трахнуть', 'полечить', 'работать', 'помахать', 'шлепнуть', 'здоровье', 'ущипнуть', 'обозвать', 'толкнуть', 'кивнуть', 'обидеть', 'плюнуть', 'шепнуть', 'ударить', 'укусить', 'напоить', 'магазин', 'профиль', 'уебать', 'мое хп', 'обнять', 'моё хп', 'пнуть', 'топ', 'хп']
2025-07-18 16:53:22,694 - DEBUG - censor_module - setup_censor_handlers: Включение censor_router в главный диспетчер.
2025-07-18 16:53:22,694 - INFO - censor_module - setup_censor_handlers: Обработчики модуля цензуры успешно настроены и включены в главный диспетчер.
2025-07-18 16:53:22,694 - INFO - core.main.ez_main - main: Модуль цензуры успешно интегрирован.
2025-07-18 16:53:22,694 - INFO - core.main.ez_main - main: Создан роутер для групповых текстовых сообщений.
2025-07-18 16:53:22,694 - INFO - core.main.ez_main - main: Включение stat_router в group_text_router.
2025-07-18 16:53:22,695 - INFO - core.group.stat.smain - Registering stat router handlers.
2025-07-18 16:53:22,695 - INFO - core.group.stat.smain - Stat router included in Dispatcher.
2025-07-18 16:53:22,695 - INFO - core.main.ez_main - main: Включение rp_router в group_text_router.
2025-07-18 16:53:22,695 - INFO - core.group.RP.rmain - RP router included and configured.
2025-07-18 16:53:22,696 - INFO - core.main.ez_main - main: group_text_router успешно интегрирован в главный диспетчер.
2025-07-18 16:53:22,697 - INFO - core.main.ez_main - main: Создан роутер для приватных чатов.
2025-07-18 16:53:22,697 - INFO - core.main.ez_main - main: Регистрация основных обработчиков команд ТОЛЬКО для приватных чатов.
2025-07-18 16:53:22,698 - INFO - core.main.ez_main - main: Основной обработчик текстовых сообщений для ЛС зарегистрирован в private_router.
2025-07-18 16:53:22,698 - INFO - core.main.ez_main - main: private_router успешно интегрирован в главный диспетчер.
2025-07-18 16:53:22,698 - INFO - core.main.ez_main - main: Запуск фоновых задач.
2025-07-18 16:53:22,698 - INFO - core.main.ez_main - main: Запуск поллинга бота...
2025-07-18 16:53:22,698 - INFO - aiogram.dispatcher - Start polling
2025-07-18 16:53:22,698 - INFO - core.main.ez_main - Jokes task started.
2025-07-18 16:53:22,699 - WARNING - core.main.ez_main - Jokes task disabled: CHANNEL_ID is not set or invalid.
2025-07-18 16:53:22,699 - INFO - core.group.RP.rmain - Periodic HP recovery task started.
2025-07-18 16:53:23,932 - INFO - aiogram.dispatcher - Run polling for bot @infernal_madam_bot id=6543660809 - 'Мэрри Шэдоу💔'
2025-07-18 16:53:24,196 - DEBUG - censor_module - censor_message_handler: Получено сообщение: 'профиль' от пользователя 5315054003 в чате -1002640920461.
2025-07-18 16:53:24,196 - DEBUG - censor_module - censor_message_handler: Сообщение 'профиль' является известной не-слеш командой 'профиль'. Пропускаем цензуру.
2025-07-18 16:53:24,196 - INFO - aiogram.event - Update id=836455725 is handled. Duration 0 ms by bot id=6543660809
2025-07-18 16:54:22,703 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F37F240>
2025-07-18 16:54:22,704 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F37F240> completed
2025-07-18 16:54:22,704 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752846862.7031932))
2025-07-18 16:54:22,704 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752846862.7031932)) completed
2025-07-18 16:54:22,704 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 16:54:22,705 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 16:54:22,705 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 16:54:22,705 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 16:54:22,705 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>)
2025-07-18 16:54:22,705 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>) completed
2025-07-18 16:55:22,714 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F37F4C0>
2025-07-18 16:55:22,715 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F37F4C0> completed
2025-07-18 16:55:22,715 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B010>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752846922.714554))
2025-07-18 16:55:22,716 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B010>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752846922.714554)) completed
2025-07-18 16:55:22,716 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 16:55:22,717 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 16:55:22,717 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 16:55:22,717 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 16:55:22,717 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B010>)
2025-07-18 16:55:22,718 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B010>) completed
2025-07-18 16:56:22,727 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F343E20>
2025-07-18 16:56:22,727 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F343E20> completed
2025-07-18 16:56:22,728 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752846982.7272384))
2025-07-18 16:56:22,728 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752846982.7272384)) completed
2025-07-18 16:56:22,729 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 16:56:22,729 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 16:56:22,730 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 16:56:22,730 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 16:56:22,730 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>)
2025-07-18 16:56:22,730 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>) completed
2025-07-18 16:57:22,754 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F343E20>
2025-07-18 16:57:22,755 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F343E20> completed
2025-07-18 16:57:22,755 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847042.7548988))
2025-07-18 16:57:22,755 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847042.7548988)) completed
2025-07-18 16:57:22,756 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 16:57:22,756 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 16:57:22,756 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 16:57:22,756 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 16:57:22,757 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>)
2025-07-18 16:57:22,757 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>) completed
2025-07-18 16:58:22,761 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F343E20>
2025-07-18 16:58:22,761 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F343E20> completed
2025-07-18 16:58:22,761 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847102.760819))
2025-07-18 16:58:22,762 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847102.760819)) completed
2025-07-18 16:58:22,762 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 16:58:22,762 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 16:58:22,763 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 16:58:22,763 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 16:58:22,763 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>)
2025-07-18 16:58:22,763 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>) completed
2025-07-18 16:59:22,762 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F341800>
2025-07-18 16:59:22,763 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F341800> completed
2025-07-18 16:59:22,763 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847162.7620854))
2025-07-18 16:59:22,763 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847162.7620854)) completed
2025-07-18 16:59:22,764 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 16:59:22,764 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 16:59:22,764 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 16:59:22,765 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 16:59:22,765 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>)
2025-07-18 16:59:22,765 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>) completed
2025-07-18 17:00:22,771 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F343E20>
2025-07-18 17:00:22,772 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F343E20> completed
2025-07-18 17:00:22,772 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847222.7714603))
2025-07-18 17:00:22,773 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847222.7714603)) completed
2025-07-18 17:00:22,773 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 17:00:22,774 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 17:00:22,774 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 17:00:22,774 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 17:00:22,774 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>)
2025-07-18 17:00:22,775 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>) completed
2025-07-18 17:01:22,774 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x00000225432F40E0>
2025-07-18 17:01:22,775 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x00000225432F40E0> completed
2025-07-18 17:01:22,775 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847282.774103))
2025-07-18 17:01:22,776 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847282.774103)) completed
2025-07-18 17:01:22,776 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 17:01:22,776 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 17:01:22,776 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>)
2025-07-18 17:01:22,776 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DF040>) completed
2025-07-18 17:01:22,777 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>)
2025-07-18 17:01:22,777 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>) completed
2025-07-18 17:02:22,787 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x00000225432F40E0>
2025-07-18 17:02:22,788 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x00000225432F40E0> completed
2025-07-18 17:02:22,788 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847342.7870252))
2025-07-18 17:02:22,789 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847342.7870252)) completed
2025-07-18 17:02:22,789 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F3F84C0>)
2025-07-18 17:02:22,790 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F3F84C0>) completed
2025-07-18 17:02:22,790 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F3F84C0>)
2025-07-18 17:02:22,790 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F3F84C0>) completed
2025-07-18 17:02:22,790 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>)
2025-07-18 17:02:22,790 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>) completed
2025-07-18 17:03:22,787 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F343E20>
2025-07-18 17:03:22,788 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F343E20> completed
2025-07-18 17:03:22,788 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847402.7871227))
2025-07-18 17:03:22,788 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847402.7871227)) completed
2025-07-18 17:03:22,789 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 17:03:22,789 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 17:03:22,789 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 17:03:22,789 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 17:03:22,790 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>)
2025-07-18 17:03:22,790 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>) completed
2025-07-18 17:04:22,794 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F343E20>
2025-07-18 17:04:22,795 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F343E20> completed
2025-07-18 17:04:22,795 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847462.7943277))
2025-07-18 17:04:22,796 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847462.7943277)) completed
2025-07-18 17:04:22,796 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 17:04:22,796 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 17:04:22,796 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 17:04:22,797 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 17:04:22,797 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>)
2025-07-18 17:04:22,797 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>) completed
2025-07-18 17:05:22,807 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F343E20>
2025-07-18 17:05:22,808 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F343E20> completed
2025-07-18 17:05:22,808 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847522.8072956))
2025-07-18 17:05:22,808 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30A6B0>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847522.8072956)) completed
2025-07-18 17:05:22,809 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 17:05:22,809 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 17:05:22,809 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>)
2025-07-18 17:05:22,810 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F2DEF40>) completed
2025-07-18 17:05:22,810 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>)
2025-07-18 17:05:22,810 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30A6B0>) completed
2025-07-18 17:06:22,822 - DEBUG - aiosqlite - executing <function connect.<locals>.connector at 0x000002254F341800>
2025-07-18 17:06:22,823 - DEBUG - aiosqlite - operation <function connect.<locals>.connector at 0x000002254F341800> completed
2025-07-18 17:06:22,823 - DEBUG - aiosqlite - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847582.8223472))
2025-07-18 17:06:22,824 - DEBUG - aiosqlite - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000002254F30B100>, '\n        SELECT user_id, hp\n        FROM rp_user_stats\n        WHERE hp <= ? AND recovery_end_ts > 0 AND recovery_end_ts <= ?\n    ', (0, 1752847582.8223472)) completed
2025-07-18 17:06:22,824 - DEBUG - aiosqlite - executing functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F3F8140>)
2025-07-18 17:06:22,824 - DEBUG - aiosqlite - operation functools.partial(<built-in method fetchall of sqlite3.Cursor object at 0x000002254F3F8140>) completed
2025-07-18 17:06:22,824 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F3F8140>)
2025-07-18 17:06:22,824 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000002254F3F8140>) completed
2025-07-18 17:06:22,825 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>)
2025-07-18 17:06:22,825 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F30B100>) completed
2025-07-18 17:06:46,536 - INFO - aiogram.dispatcher - Polling stopped
2025-07-18 17:06:46,799 - INFO - core.main.ez_main - main: Остановка бота...
2025-07-18 17:06:46,799 - INFO - core.main.ez_main - main: Фоновые задачи успешно отменены.
2025-07-18 17:06:46,799 - DEBUG - core.group.stat.smain - Attempting to close profiles database connection.
2025-07-18 17:06:46,799 - DEBUG - aiosqlite - executing functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F3094E0>)
2025-07-18 17:06:46,800 - DEBUG - aiosqlite - operation functools.partial(<built-in method close of sqlite3.Connection object at 0x000002254F3094E0>) completed
2025-07-18 17:06:46,800 - INFO - core.group.stat.smain - Profiles database connection closed successfully.
2025-07-18 17:06:46,800 - INFO - core.main.ez_main - main: Соединение ProfileManager закрыто.
2025-07-18 17:06:46,800 - INFO - core.main.ez_main - main: Сессия бота закрыта. Выход.
2025-07-18 17:06:46,800 - INFO - aiogram.dispatcher - Polling stopped for bot @infernal_madam_bot id=6543660809 - 'Мэрри Шэдоу💔'
2025-07-18 17:06:46,801 - INFO - core.main.ez_main - main: Бот остановлен вручную (KeyboardInterrupt).
